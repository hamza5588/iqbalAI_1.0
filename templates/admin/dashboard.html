<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Iqbal AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'iqbal-primary': '#05B0FC',
                        'iqbal-bg': '#F0F9FF'
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar-item:hover {
            background: linear-gradient(90deg, rgba(5, 176, 252, 0.1) 0%, transparent 100%);
        }
        .sidebar-item.active {
            background: linear-gradient(90deg, rgba(5, 176, 252, 0.2) 0%, transparent 100%);
            border-left: 3px solid #05B0FC;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation Bar -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-[#05B0FC]">Admin Dashboard</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/" class="text-gray-600 hover:text-[#05B0FC] transition-colors">
                        <i class="fas fa-home mr-2"></i>Back to App
                    </a>
                    <a href="/auth/logout" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="flex">
        <!-- Sidebar -->
        <aside class="w-64 bg-white shadow-lg min-h-screen">
            <div class="p-4">
                <nav class="space-y-2">
                    <a href="#" onclick="showSection('dashboard'); return false;" 
                       class="sidebar-item active flex items-center px-4 py-3 text-gray-700 hover:text-[#05B0FC] transition-colors rounded-lg">
                        <i class="fas fa-chart-line w-5 mr-3"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="#" onclick="showSection('users'); return false;" 
                       class="sidebar-item flex items-center px-4 py-3 text-gray-700 hover:text-[#05B0FC] transition-colors rounded-lg">
                        <i class="fas fa-users w-5 mr-3"></i>
                        <span>User Management</span>
                    </a>
                    <a href="#" onclick="showSection('prompts'); return false;" 
                       class="sidebar-item flex items-center px-4 py-3 text-gray-700 hover:text-[#05B0FC] transition-colors rounded-lg">
                        <i class="fas fa-comment-dots w-5 mr-3"></i>
                        <span>Global Prompts</span>
                    </a>
                    <a href="#" onclick="showSection('coupons'); return false;" 
                       class="sidebar-item flex items-center px-4 py-3 text-gray-700 hover:text-[#05B0FC] transition-colors rounded-lg">
                        <i class="fas fa-ticket-alt w-5 mr-3"></i>
                        <span>Coupons</span>
                    </a>
                    <a href="#" onclick="showSection('lessons'); return false;" 
                       class="sidebar-item flex items-center px-4 py-3 text-gray-700 hover:text-[#05B0FC] transition-colors rounded-lg">
                        <i class="fas fa-book w-5 mr-3"></i>
                        <span>Lessons</span>
                    </a>
                    <a href="#" onclick="showSection('documents'); return false;" 
                       class="sidebar-item flex items-center px-4 py-3 text-gray-700 hover:text-[#05B0FC] transition-colors rounded-lg">
                        <i class="fas fa-file-pdf w-5 mr-3"></i>
                        <span>Documents</span>
                    </a>
                    <a href="#" onclick="showSection('settings'); return false;" 
                       class="sidebar-item flex items-center px-4 py-3 text-gray-700 hover:text-[#05B0FC] transition-colors rounded-lg">
                        <i class="fas fa-cog w-5 mr-3"></i>
                        <span>Settings</span>
                    </a>
                </nav>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-8">
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="section">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Dashboard Overview</h2>
                
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-blue-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Total Users</p>
                                <p class="text-3xl font-bold text-gray-800 mt-2" id="stat-total-users">-</p>
                            </div>
                            <div class="bg-blue-100 p-3 rounded-full">
                                <i class="fas fa-users text-blue-500 text-2xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-green-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Teachers</p>
                                <p class="text-3xl font-bold text-gray-800 mt-2" id="stat-total-teachers">-</p>
                            </div>
                            <div class="bg-green-100 p-3 rounded-full">
                                <i class="fas fa-chalkboard-teacher text-green-500 text-2xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-purple-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Students</p>
                                <p class="text-3xl font-bold text-gray-800 mt-2" id="stat-total-students">-</p>
                            </div>
                            <div class="bg-purple-100 p-3 rounded-full">
                                <i class="fas fa-user-graduate text-purple-500 text-2xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-yellow-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Total Lessons</p>
                                <p class="text-3xl font-bold text-gray-800 mt-2" id="stat-total-lessons">-</p>
                            </div>
                            <div class="bg-yellow-100 p-3 rounded-full">
                                <i class="fas fa-book text-yellow-500 text-2xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-red-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Documents</p>
                                <p class="text-3xl font-bold text-gray-800 mt-2" id="stat-total-documents">-</p>
                            </div>
                            <div class="bg-red-100 p-3 rounded-full">
                                <i class="fas fa-file-pdf text-red-500 text-2xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-indigo-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Coupons</p>
                                <p class="text-3xl font-bold text-gray-800 mt-2" id="stat-total-coupons">-</p>
                            </div>
                            <div class="bg-indigo-100 p-3 rounded-full">
                                <i class="fas fa-ticket-alt text-indigo-500 text-2xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Section -->
            <div id="users-section" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">User Management</h2>
                    <button onclick="showCreateUserModal()" class="bg-[#05B0FC] text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        <i class="fas fa-plus mr-2"></i>Create User
                    </button>
                </div>
                
                <!-- Filters -->
                <div class="bg-white rounded-lg shadow-md p-4 mb-6">
                    <div class="flex flex-wrap gap-4">
                        <select id="user-role-filter" onchange="loadUsers()" class="border border-gray-300 rounded-lg px-4 py-2">
                            <option value="all">All Roles</option>
                            <option value="admin">Admin</option>
                            <option value="teacher">Teacher</option>
                            <option value="student">Student</option>
                        </select>
                        <input type="text" id="user-search" placeholder="Search users..." 
                               onkeyup="loadUsers()" class="border border-gray-300 rounded-lg px-4 py-2 flex-1 min-w-[200px]">
                    </div>
                </div>
                
                <!-- Users Table -->
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div id="users-table-container" class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subscription</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-tbody" class="bg-white divide-y divide-gray-200">
                                <tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div id="users-pagination" class="px-6 py-4 border-t border-gray-200"></div>
                </div>
            </div>

            <!-- Prompts Section -->
            <div id="prompts-section" class="section hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Global Prompt Management</h2>
                
                <div class="bg-white rounded-lg shadow-md p-6">
                    <p class="text-gray-600 mb-4">Set a global system prompt that will be applied to all users. This prompt will be combined with user-specific prompts.</p>
                    
                    <textarea id="global-prompt-text" rows="15" 
                              class="w-full border border-gray-300 rounded-lg p-4 font-mono text-sm"
                              placeholder="Enter global system prompt here..."></textarea>
                    
                    <div class="flex gap-4 mt-4">
                        <button onclick="loadGlobalPrompt()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                            <i class="fas fa-sync mr-2"></i>Load Current
                        </button>
                        <button onclick="saveGlobalPrompt()" class="bg-[#05B0FC] text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            <i class="fas fa-save mr-2"></i>Save Prompt
                        </button>
                        <button onclick="deleteGlobalPrompt()" class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-colors">
                            <i class="fas fa-trash mr-2"></i>Delete Prompt
                        </button>
                    </div>
                </div>
            </div>

            <!-- Coupons Section -->
            <div id="coupons-section" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">Coupon Management</h2>
                    <button onclick="showCreateCouponModal()" class="bg-[#05B0FC] text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        <i class="fas fa-plus mr-2"></i>Create Coupon
                    </button>
                </div>
                
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div id="coupons-table-container" class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Code</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tier</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Used</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Max Uses</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="coupons-tbody" class="bg-white divide-y divide-gray-200">
                                <tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Lessons Section -->
            <div id="lessons-section" class="section hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Lesson Management</h2>
                
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div id="lessons-table-container" class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Title</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Teacher</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Created</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="lessons-tbody" class="bg-white divide-y divide-gray-200">
                                <tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Documents Section -->
            <div id="documents-section" class="section hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Document Management</h2>
                
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div id="documents-table-container" class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">File Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">User</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Size</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Uploaded</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="documents-tbody" class="bg-white divide-y divide-gray-200">
                                <tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings-section" class="section hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">System Settings</h2>
                
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">LLM Provider Selection</h3>
                    <p class="text-gray-600 mb-4">Choose the LLM provider that will be used for all chat requests system-wide.</p>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Current Provider</label>
                            <div class="flex items-center gap-4">
                                <label class="flex items-center">
                                    <input type="radio" name="llm-provider" value="openai" id="provider-openai"
                                           class="mr-2 text-[#05B0FC] focus:ring-[#05B0FC]">
                                    <span class="text-gray-700">OpenAI</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="llm-provider" value="groq" id="provider-groq"
                                           class="mr-2 text-[#05B0FC] focus:ring-[#05B0FC]">
                                    <span class="text-gray-700">Groq (LLaMA)</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                            <p class="text-sm text-blue-800">
                                <strong>Note:</strong> When Groq is selected, users (students and teachers) must configure their own Groq API keys. 
                                The API key configuration option will be visible in the chat interface.
                            </p>
                        </div>
                        
                        <button onclick="saveLLMProvider()" class="bg-[#05B0FC] text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            <i class="fas fa-save mr-2"></i>Save Provider Selection
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    
    <!-- Create User Modal -->
    <div id="create-user-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-900">Create New User</h3>
                    <button onclick="closeModal('create-user-modal')" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="create-user-form" onsubmit="createUser(event)">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Username *</label>
                            <input type="text" id="create-username" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#05B0FC] focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                            <input type="email" id="create-email" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#05B0FC] focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Password *</label>
                            <input type="password" id="create-password" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#05B0FC] focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Role *</label>
                            <select id="create-role" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#05B0FC] focus:border-transparent">
                                <option value="student">Student</option>
                                <option value="teacher">Teacher</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Class Standard</label>
                            <input type="text" id="create-class-standard"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#05B0FC] focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Medium</label>
                            <input type="text" id="create-medium"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#05B0FC] focus:border-transparent">
                        </div>
                    </div>
                    <div class="flex gap-3 mt-6">
                        <button type="submit" class="flex-1 bg-[#05B0FC] text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            Create User
                        </button>
                        <button type="button" onclick="closeModal('create-user-modal')" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition-colors">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="edit-user-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-900">Edit User</h3>
                    <button onclick="closeModal('edit-user-modal')" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="edit-user-form" onsubmit="updateUser(event)">
                    <input type="hidden" id="edit-user-id">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Username *</label>
                            <input type="text" id="edit-username" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#05B0FC] focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                            <input type="email" id="edit-email" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#05B0FC] focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Role *</label>
                            <select id="edit-role" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#05B0FC] focus:border-transparent">
                                <option value="student">Student</option>
                                <option value="teacher">Teacher</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Class Standard</label>
                            <input type="text" id="edit-class-standard"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#05B0FC] focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Medium</label>
                            <input type="text" id="edit-medium"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#05B0FC] focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Subscription Tier</label>
                            <select id="edit-subscription-tier"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#05B0FC] focus:border-transparent">
                                <option value="free">Free</option>
                                <option value="pro">Pro</option>
                                <option value="pro_plus">Pro Plus</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex gap-3 mt-6">
                        <button type="submit" class="flex-1 bg-[#05B0FC] text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            Update User
                        </button>
                        <button type="button" onclick="closeModal('edit-user-modal')" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition-colors">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Create Coupon Modal -->
    <div id="create-coupon-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-900">Create New Coupon</h3>
                    <button onclick="closeModal('create-coupon-modal')" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="create-coupon-form" onsubmit="createCoupon(event)">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Coupon Code *</label>
                            <input type="text" id="create-coupon-code" required placeholder="e.g., SUMMER2024"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#05B0FC] focus:border-transparent uppercase">
                            <p class="text-xs text-gray-500 mt-1">Code will be converted to uppercase</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Subscription Tier *</label>
                            <select id="create-coupon-tier" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#05B0FC] focus:border-transparent">
                                <option value="pro">Pro</option>
                                <option value="pro_plus">Pro Plus</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <textarea id="create-coupon-description" rows="3"
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#05B0FC] focus:border-transparent"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Max Uses</label>
                            <input type="number" id="create-coupon-max-uses" min="1"
                                   placeholder="Leave empty for unlimited"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#05B0FC] focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Expires At</label>
                            <input type="datetime-local" id="create-coupon-expires"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#05B0FC] focus:border-transparent">
                            <p class="text-xs text-gray-500 mt-1">Leave empty for no expiration</p>
                        </div>
                    </div>
                    <div class="flex gap-3 mt-6">
                        <button type="submit" class="flex-1 bg-[#05B0FC] text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            Create Coupon
                        </button>
                        <button type="button" onclick="closeModal('create-coupon-modal')" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition-colors">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification-toast" class="hidden fixed top-4 right-4 z-50">
        <div class="bg-white rounded-lg shadow-lg border-l-4 p-4 min-w-[300px] max-w-md">
            <div class="flex items-center">
                <div id="toast-icon" class="mr-3"></div>
                <div class="flex-1">
                    <p id="toast-message" class="text-sm font-medium"></p>
                </div>
                <button onclick="hideNotification()" class="ml-4 text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentPage = {
            users: 1,
            lessons: 1,
            documents: 1
        };

        // Load dashboard stats
        function loadDashboardStats() {
            // Stats are passed from server-side rendering
            const stats = {{ stats | tojson }};
            if (stats) {
                document.getElementById('stat-total-users').textContent = stats.total_users || 0;
                document.getElementById('stat-total-teachers').textContent = stats.total_teachers || 0;
                document.getElementById('stat-total-students').textContent = stats.total_students || 0;
                document.getElementById('stat-total-lessons').textContent = stats.total_lessons || 0;
                document.getElementById('stat-total-documents').textContent = stats.total_documents || 0;
                document.getElementById('stat-total-coupons').textContent = stats.total_coupons || 0;
            }
        }

        // Section navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            
            // Remove active class from all sidebar items
            document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
            
            // Show selected section
            document.getElementById(sectionName + '-section').classList.remove('hidden');
            
            // Add active class to clicked sidebar item
            event.target.closest('.sidebar-item').classList.add('active');
            
            // Load section data
            if (sectionName === 'dashboard') {
                loadDashboardStats();
            } else if (sectionName === 'users') {
                loadUsers();
            } else if (sectionName === 'prompts') {
                loadGlobalPrompt();
            } else if (sectionName === 'coupons') {
                loadCoupons();
            } else if (sectionName === 'lessons') {
                loadLessons();
            } else if (sectionName === 'documents') {
                loadDocuments();
            } else if (sectionName === 'settings') {
                loadLLMProvider();
            }
        }

        // User Management
        async function loadUsers(page = 1) {
            const role = document.getElementById('user-role-filter').value;
            const search = document.getElementById('user-search').value;
            
            try {
                const params = new URLSearchParams({
                    role: role,
                    search: search,
                    page: page,
                    per_page: 50
                });
                
                const response = await fetch(`/admin/users?${params}`);
                const data = await response.json();
                
                if (data.success) {
                    renderUsersTable(data.users);
                    renderPagination('users-pagination', data, loadUsers);
                } else {
                    showNotification('Error loading users: ' + data.error, 'error');
                }
            } catch (error) {
                console.error('Error loading users:', error);
                showNotification('Error loading users', 'error');
            }
        }

        function renderUsersTable(users) {
            const tbody = document.getElementById('users-tbody');
            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">No users found</td></tr>';
                return;
            }
            
            tbody.innerHTML = users.map(user => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${user.username}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.useremail}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${
                            user.role === 'admin' ? 'bg-red-100 text-red-800' :
                            user.role === 'teacher' ? 'bg-blue-100 text-blue-800' :
                            'bg-green-100 text-green-800'
                        }">${user.role}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.subscription_tier}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editUser(${user.id})" class="text-[#05B0FC] hover:text-blue-600 mr-3">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="changeUserPassword(${user.id})" class="text-yellow-600 hover:text-yellow-800 mr-3">
                            <i class="fas fa-key"></i>
                        </button>
                        <button onclick="deleteUser(${user.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Global Prompt Management
        async function loadGlobalPrompt() {
            try {
                const response = await fetch('/admin/prompt/global');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('global-prompt-text').value = data.prompt || '';
                } else {
                    showNotification('Error loading prompt: ' + data.error, 'error');
                }
            } catch (error) {
                console.error('Error loading prompt:', error);
                showNotification('Error loading prompt', 'error');
            }
        }

        async function saveGlobalPrompt() {
            const prompt = document.getElementById('global-prompt-text').value.trim();
            
            try {
                const response = await fetch('/admin/prompt/global', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({prompt: prompt})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Global prompt saved successfully!', 'success');
                } else {
                    showNotification('Error saving prompt: ' + data.error, 'error');
                }
            } catch (error) {
                console.error('Error saving prompt:', error);
                showNotification('Error saving prompt', 'error');
            }
        }

        async function deleteGlobalPrompt() {
            if (!confirm('Are you sure you want to delete the global prompt?')) return;
            
            try {
                const response = await fetch('/admin/prompt/global', {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('global-prompt-text').value = '';
                    showNotification('Global prompt deleted successfully!', 'success');
                } else {
                    showNotification('Error deleting prompt: ' + data.error, 'error');
                }
            } catch (error) {
                console.error('Error deleting prompt:', error);
                showNotification('Error deleting prompt', 'error');
            }
        }

        // Coupon Management
        async function loadCoupons() {
            try {
                const response = await fetch('/admin/coupons');
                const data = await response.json();
                
                if (data.success) {
                    renderCouponsTable(data.coupons);
                } else {
                    showNotification('Error loading coupons: ' + data.error, 'error');
                }
            } catch (error) {
                console.error('Error loading coupons:', error);
                showNotification('Error loading coupons', 'error');
            }
        }

        function renderCouponsTable(coupons) {
            const tbody = document.getElementById('coupons-tbody');
            if (coupons.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">No coupons found</td></tr>';
                return;
            }
            
            tbody.innerHTML = coupons.map(coupon => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${coupon.code}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${coupon.subscription_tier}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${coupon.used_count}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${coupon.max_uses || 'Unlimited'}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${
                            coupon.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                        }">${coupon.is_active ? 'Active' : 'Inactive'}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="deleteCoupon(${coupon.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Lesson Management
        async function loadLessons() {
            try {
                const response = await fetch('/admin/lessons');
                const data = await response.json();
                
                if (data.success) {
                    renderLessonsTable(data.lessons);
                } else {
                    showNotification('Error loading lessons: ' + data.error, 'error');
                }
            } catch (error) {
                console.error('Error loading lessons:', error);
                showNotification('Error loading lessons', 'error');
            }
        }

        function renderLessonsTable(lessons) {
            const tbody = document.getElementById('lessons-tbody');
            if (lessons.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">No lessons found</td></tr>';
                return;
            }
            
            tbody.innerHTML = lessons.map(lesson => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${lesson.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${lesson.title}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${lesson.teacher_name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(lesson.created_at).toLocaleDateString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="deleteLesson(${lesson.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Document Management
        async function loadDocuments() {
            try {
                const response = await fetch('/admin/documents');
                const data = await response.json();
                
                if (data.success) {
                    renderDocumentsTable(data.documents);
                } else {
                    showNotification('Error loading documents: ' + data.error, 'error');
                }
            } catch (error) {
                console.error('Error loading documents:', error);
                showNotification('Error loading documents', 'error');
            }
        }

        function renderDocumentsTable(documents) {
            const tbody = document.getElementById('documents-tbody');
            if (documents.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">No documents found</td></tr>';
                return;
            }
            
            tbody.innerHTML = documents.map(doc => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${doc.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${doc.file_name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${doc.username}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatFileSize(doc.file_size)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(doc.uploaded_at).toLocaleDateString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="deleteDocument(${doc.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Utility functions
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function showNotification(message, type = 'info') {
            const toast = document.getElementById('notification-toast');
            const messageEl = document.getElementById('toast-message');
            const iconEl = document.getElementById('toast-icon');
            
            messageEl.textContent = message;
            
            // Set icon and color based on type
            const colors = {
                'success': { bg: 'bg-green-500', icon: 'fa-check-circle', border: 'border-green-500' },
                'error': { bg: 'bg-red-500', icon: 'fa-exclamation-circle', border: 'border-red-500' },
                'warning': { bg: 'bg-yellow-500', icon: 'fa-exclamation-triangle', border: 'border-yellow-500' },
                'info': { bg: 'bg-blue-500', icon: 'fa-info-circle', border: 'border-blue-500' }
            };
            
            const style = colors[type] || colors.info;
            toast.className = `fixed top-4 right-4 z-50 ${style.border}`;
            iconEl.innerHTML = `<i class="fas ${style.icon} ${style.bg} text-white rounded-full p-2"></i>`;
            
            toast.classList.remove('hidden');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                hideNotification();
            }, 5000);
        }

        function hideNotification() {
            document.getElementById('notification-toast').classList.add('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function renderPagination(containerId, data, loadFunction) {
            const container = document.getElementById(containerId);
            if (!container || data.total_pages <= 1) {
                if (container) container.innerHTML = '';
                return;
            }
            
            let html = '<div class="flex justify-between items-center">';
            html += `<span class="text-sm text-gray-700">Showing ${(data.page - 1) * data.per_page + 1} to ${Math.min(data.page * data.per_page, data.total)} of ${data.total} results</span>`;
            html += '<div class="flex gap-2">';
            
            if (data.page > 1) {
                html += `<button onclick="${loadFunction.name}(${data.page - 1})" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Previous</button>`;
            }
            
            if (data.page < data.total_pages) {
                html += `<button onclick="${loadFunction.name}(${data.page + 1})" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Next</button>`;
            }
            
            html += '</div></div>';
            container.innerHTML = html;
        }

        // Create User
        function showCreateUserModal() {
            // Reset form
            document.getElementById('create-user-form').reset();
            openModal('create-user-modal');
        }

        async function createUser(event) {
            event.preventDefault();
            
            const data = {
                username: document.getElementById('create-username').value.trim(),
                useremail: document.getElementById('create-email').value.trim(),
                password: document.getElementById('create-password').value,
                role: document.getElementById('create-role').value,
                class_standard: document.getElementById('create-class-standard').value.trim() || 'N/A',
                medium: document.getElementById('create-medium').value.trim() || 'N/A'
            };
            
            try {
                const response = await fetch('/admin/users', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('User created successfully!', 'success');
                    closeModal('create-user-modal');
                    loadUsers(); // Refresh user list
                } else {
                    showNotification('Error: ' + (result.error || 'Failed to create user'), 'error');
                }
            } catch (error) {
                console.error('Error creating user:', error);
                showNotification('Error creating user: ' + error.message, 'error');
            }
        }

        // Edit User
        async function editUser(userId) {
            try {
                // Load user data directly by ID
                const response = await fetch(`/admin/users/${userId}`);
                const data = await response.json();
                
                if (data.success && data.user) {
                    const user = data.user;
                    document.getElementById('edit-user-id').value = user.id;
                    document.getElementById('edit-username').value = user.username;
                    document.getElementById('edit-email').value = user.useremail;
                    document.getElementById('edit-role').value = user.role;
                    document.getElementById('edit-class-standard').value = user.class_standard || '';
                    document.getElementById('edit-medium').value = user.medium || '';
                    document.getElementById('edit-subscription-tier').value = user.subscription_tier || 'free';
                    
                    openModal('edit-user-modal');
                } else {
                    showNotification('Error: ' + (data.error || 'User not found'), 'error');
                }
            } catch (error) {
                console.error('Error loading user:', error);
                showNotification('Error loading user: ' + error.message, 'error');
            }
        }

        async function updateUser(event) {
            event.preventDefault();
            
            const userId = document.getElementById('edit-user-id').value;
            const data = {
                username: document.getElementById('edit-username').value.trim(),
                useremail: document.getElementById('edit-email').value.trim(),
                role: document.getElementById('edit-role').value,
                class_standard: document.getElementById('edit-class-standard').value.trim() || 'N/A',
                medium: document.getElementById('edit-medium').value.trim() || 'N/A',
                subscription_tier: document.getElementById('edit-subscription-tier').value
            };
            
            try {
                const response = await fetch(`/admin/users/${userId}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('User updated successfully!', 'success');
                    closeModal('edit-user-modal');
                    loadUsers(); // Refresh user list
                } else {
                    showNotification('Error: ' + (result.error || 'Failed to update user'), 'error');
                }
            } catch (error) {
                console.error('Error updating user:', error);
                showNotification('Error updating user: ' + error.message, 'error');
            }
        }

        // Create Coupon
        function showCreateCouponModal() {
            // Reset form
            document.getElementById('create-coupon-form').reset();
            openModal('create-coupon-modal');
        }

        async function createCoupon(event) {
            event.preventDefault();
            
            const code = document.getElementById('create-coupon-code').value.trim().toUpperCase();
            const data = {
                code: code,
                subscription_tier: document.getElementById('create-coupon-tier').value,
                description: document.getElementById('create-coupon-description').value.trim(),
                max_uses: document.getElementById('create-coupon-max-uses').value || null,
                expires_at: document.getElementById('create-coupon-expires').value || null
            };
            
            // Convert expires_at to ISO format if provided
            if (data.expires_at) {
                const date = new Date(data.expires_at);
                data.expires_at = date.toISOString();
            }
            
            // Convert max_uses to integer if provided
            if (data.max_uses) {
                data.max_uses = parseInt(data.max_uses);
            }
            
            try {
                const response = await fetch('/admin/coupons', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Coupon created successfully!', 'success');
                    closeModal('create-coupon-modal');
                    loadCoupons(); // Refresh coupon list
                } else {
                    showNotification('Error: ' + (result.error || 'Failed to create coupon'), 'error');
                }
            } catch (error) {
                console.error('Error creating coupon:', error);
                showNotification('Error creating coupon: ' + error.message, 'error');
            }
        }

        function changeUserPassword(userId) {
            const newPassword = prompt('Enter new password:');
            if (newPassword) {
                fetch(`/admin/users/${userId}/change-password`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({password: newPassword})
                })
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        showNotification('Password changed successfully!', 'success');
                    } else {
                        showNotification('Error: ' + data.error, 'error');
                    }
                });
            }
        }

        function deleteUser(userId) {
            if (!confirm('Are you sure you want to delete this user?')) return;
            
            fetch(`/admin/users/${userId}`, {method: 'DELETE'})
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        showNotification('User deleted successfully!', 'success');
                        loadUsers();
                    } else {
                        showNotification('Error: ' + data.error, 'error');
                    }
                });
        }

        function deleteCoupon(couponId) {
            if (!confirm('Are you sure you want to delete this coupon?')) return;
            
            fetch(`/admin/coupons/${couponId}`, {method: 'DELETE'})
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        showNotification('Coupon deleted successfully!', 'success');
                        loadCoupons();
                    } else {
                        showNotification('Error: ' + data.error, 'error');
                    }
                });
        }

        function deleteLesson(lessonId) {
            if (!confirm('Are you sure you want to delete this lesson?')) return;
            
            fetch(`/admin/lessons/${lessonId}`, {method: 'DELETE'})
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        showNotification('Lesson deleted successfully!', 'success');
                        loadLessons();
                    } else {
                        showNotification('Error: ' + data.error, 'error');
                    }
                });
        }

        function deleteDocument(docId) {
            if (!confirm('Are you sure you want to delete this document?')) return;
            
            fetch(`/admin/documents/${docId}`, {method: 'DELETE'})
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        showNotification('Document deleted successfully!', 'success');
                        loadDocuments();
                    } else {
                        showNotification('Error: ' + data.error, 'error');
                    }
                });
        }

        // LLM Provider Management
        async function loadLLMProvider() {
            try {
                const response = await fetch('/admin/settings/llm-provider');
                const data = await response.json();
                
                if (data.success) {
                    const provider = data.provider || 'openai';
                    document.getElementById('provider-openai').checked = provider === 'openai';
                    document.getElementById('provider-groq').checked = provider === 'groq';
                } else {
                    showNotification('Error loading LLM provider: ' + data.error, 'error');
                }
            } catch (error) {
                console.error('Error loading LLM provider:', error);
                showNotification('Error loading LLM provider', 'error');
            }
        }

        async function saveLLMProvider() {
            const selectedProvider = document.querySelector('input[name="llm-provider"]:checked');
            
            if (!selectedProvider) {
                showNotification('Please select a provider', 'warning');
                return;
            }
            
            try {
                const response = await fetch('/admin/settings/llm-provider', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({provider: selectedProvider.value})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification(`LLM provider set to ${data.provider.toUpperCase()} successfully!`, 'success');
                } else {
                    showNotification('Error saving provider: ' + data.error, 'error');
                }
            } catch (error) {
                console.error('Error saving LLM provider:', error);
                showNotification('Error saving LLM provider', 'error');
            }
        }

        // Initialize dashboard on load
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardStats();
        });
    </script>
</body>
</html>

